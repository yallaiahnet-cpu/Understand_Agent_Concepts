<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LangGraph Technical Flow - Complete Visualization</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #0f0;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: #000;
            border: 2px solid #0f0;
        }

        .header {
            background: #000;
            border-bottom: 2px solid #0f0;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            color: #0f0;
            font-size: 2.5em;
            letter-spacing: 2px;
            text-shadow: 0 0 10px #0f0;
        }

        .content {
            padding: 30px;
        }

        .step-container {
            margin: 40px 0;
            border: 2px solid #0f0;
            padding: 20px;
            background: #000;
        }

        .step-header {
            font-size: 1.8em;
            color: #0f0;
            margin-bottom: 20px;
            padding: 10px;
            border-bottom: 2px solid #0f0;
            text-transform: uppercase;
        }

        .step-number {
            display: inline-block;
            width: 50px;
            height: 50px;
            line-height: 50px;
            text-align: center;
            border: 2px solid #0f0;
            margin-right: 15px;
            font-size: 1.5em;
        }

        .code-block {
            background: #000;
            border: 1px solid #0f0;
            padding: 20px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            position: relative;
        }

        .code-label {
            color: #0f0;
            font-weight: bold;
            margin-bottom: 10px;
            padding: 5px;
            border-bottom: 1px solid #0f0;
        }

        .json-key {
            color: #0f0;
        }

        .json-value-string {
            color: #fff;
        }

        .json-value-number {
            color: #0f0;
        }

        .json-value-bool {
            color: #0f0;
        }

        .json-value-null {
            color: #888;
        }

        .arrow {
            text-align: center;
            font-size: 3em;
            color: #0f0;
            margin: 20px 0;
            text-shadow: 0 0 10px #0f0;
        }

        .flow-diagram {
            border: 2px solid #0f0;
            padding: 20px;
            margin: 20px 0;
            background: #000;
        }

        .node-box {
            border: 2px solid #0f0;
            padding: 20px;
            margin: 20px auto;
            max-width: 600px;
            background: #000;
        }

        .node-title {
            font-size: 1.5em;
            color: #0f0;
            margin-bottom: 10px;
            text-align: center;
            font-weight: bold;
        }

        .node-desc {
            color: #0f0;
            text-align: center;
            margin: 10px 0;
        }

        .state-diff {
            background: #000;
            border: 1px solid #0f0;
            padding: 15px;
            margin: 10px 0;
        }

        .state-before {
            border-left: 3px solid #888;
            padding-left: 10px;
            margin: 10px 0;
        }

        .state-after {
            border-left: 3px solid #0f0;
            padding-left: 10px;
            margin: 10px 0;
        }

        .highlight-change {
            background: #003300;
            padding: 2px 5px;
        }

        .section-title {
            color: #0f0;
            font-size: 1.3em;
            margin: 20px 0 10px 0;
            padding: 10px;
            border: 1px solid #0f0;
            background: #000;
        }

        .process-flow {
            border: 2px solid #0f0;
            padding: 15px;
            margin: 15px 0;
            background: #000;
        }

        .process-step {
            margin: 10px 0;
            padding: 10px;
            border-left: 3px solid #0f0;
        }

        .technical-note {
            background: #001100;
            border: 1px dashed #0f0;
            padding: 15px;
            margin: 15px 0;
            font-style: italic;
        }

        .split-flow {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .flow-path {
            border: 2px solid #0f0;
            padding: 15px;
            background: #000;
        }

        .path-label {
            text-align: center;
            font-size: 1.2em;
            margin-bottom: 15px;
            padding: 10px;
            border-bottom: 2px solid #0f0;
        }

        @media (max-width: 768px) {
            .split-flow {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ö° LANGGRAPH TECHNICAL FLOW ‚ö°</h1>
            <div style="margin-top: 10px; font-size: 1.2em;">COMPLETE STEP-BY-STEP EXECUTION WITH STATE TRACKING</div>
        </div>

        <div class="content">
            <!-- ========================================== -->
            <!-- INITIAL STATE: USER INPUT -->
            <!-- ========================================== -->
            <div class="step-container">
                <div class="step-header">
                    <span class="step-number">0</span>
                    INITIAL STATE: USER INPUT
                </div>

                <div class="section-title">üì• USER ENTERS DATA IN BOOKING FORM</div>
                
                <div class="code-block">
                    <div class="code-label">User fills form with:</div>
                    <pre>
Destination: "New York"
Departure Date: "2026-02-26"
Return Date: "2026-03-26"
Passengers: 2
Budget: $500
Class: "economy"</pre>
                </div>

                <div class="technical-note">
                    <strong>üîß TECHNICAL PROCESS:</strong><br>
                    1. Frontend captures form data<br>
                    2. Creates initial_state dictionary<br>
                    3. Calls: app.invoke(initial_state, config)<br>
                    4. LangGraph receives state and begins execution
                </div>

                <div class="code-block">
                    <div class="code-label">üìä INITIAL STATE OBJECT (BookingState)</div>
                    <pre>{
    <span class="json-key">"destination"</span>: <span class="json-value-string">"New York"</span>,
    <span class="json-key">"departure_date"</span>: <span class="json-value-string">"2026-02-26"</span>,
    <span class="json-key">"return_date"</span>: <span class="json-value-string">"2026-03-26"</span>,
    <span class="json-key">"passenger_count"</span>: <span class="json-value-number">2</span>,
    <span class="json-key">"max_budget"</span>: <span class="json-value-number">500.0</span>,
    <span class="json-key">"class_preference"</span>: <span class="json-value-string">"economy"</span>,
    <span class="json-key">"additional_info"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"missing_fields"</span>: [],
    <span class="json-key">"input_complete"</span>: <span class="json-value-bool">false</span>,
    <span class="json-key">"validation_status"</span>: <span class="json-value-string">"new"</span>,
    <span class="json-key">"flight_options"</span>: [],
    <span class="json-key">"search_timestamp"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"selected_flight"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"selection_reason"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"requires_approval"</span>: <span class="json-value-bool">false</span>,
    <span class="json-key">"approval_status"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"approver"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"booking_status"</span>: <span class="json-value-string">"new"</span>,
    <span class="json-key">"booking_id"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"booking_timestamp"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"error_message"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"retry_count"</span>: <span class="json-value-number">0</span>,
    <span class="json-key">"history"</span>: []
}</pre>
                </div>

                <div class="arrow">‚¨á</div>

                <div class="flow-diagram">
                    <div class="node-box">
                        <div class="node-title">üöÄ EXECUTION STARTS</div>
                        <div class="node-desc">app.invoke(initial_state, config)</div>
                    </div>
                    
                    <div class="arrow">‚¨á</div>
                    
                    <div class="technical-note">
                        <strong>üîß LANGGRAPH INTERNAL PROCESS:</strong><br>
                        1. LangGraph receives invoke() call<br>
                        2. Looks for edge from START<br>
                        3. Finds: START ‚Üí "validate_input"<br>
                        4. Routes to validate_input node<br>
                        5. Calls: validate_input(initial_state)
                    </div>
                </div>
            </div>

            <!-- ========================================== -->
            <!-- STEP 1: VALIDATE INPUT -->
            <!-- ========================================== -->
            <div class="step-container">
                <div class="step-header">
                    <span class="step-number">1</span>
                    NODE: VALIDATE_INPUT
                </div>

                <div class="section-title">üìã FUNCTION EXECUTION</div>
                
                <div class="code-block">
                    <div class="code-label">def validate_input(state: BookingState) -> BookingState:</div>
                    <pre>
# === STEP 1: READ FROM STATE ===
destination = state["destination"]           # "New York"
departure_date = state["departure_date"]     # "2026-02-26"
passenger_count = state["passenger_count"]   # 2
max_budget = state["max_budget"]             # 500.0
class_preference = state["class_preference"] # "economy"

# === STEP 2: CHECK WHAT'S MISSING ===
missing_fields = []
if not destination: missing_fields.append("destination")
if not departure_date: missing_fields.append("departure_date")
if not passenger_count: missing_fields.append("passenger_count")
if not max_budget: missing_fields.append("max_budget")
if not class_preference: missing_fields.append("class_preference")

# Result: missing_fields = [] (all fields provided!)

# === STEP 3: UPDATE STATE ===
state["missing_fields"] = []
state["validation_status"] = "complete"
state["input_complete"] = True
state["history"].append("Validation: Complete")

# === STEP 4: RETURN UPDATED STATE ===
return state</pre>
                </div>

                <div class="section-title">üìä STATE CHANGES</div>
                
                <div class="state-diff">
                    <div class="state-before">
                        <strong>BEFORE:</strong><br>
                        "missing_fields": []<br>
                        "validation_status": "new"<br>
                        "input_complete": false<br>
                        "history": []
                    </div>
                    
                    <div class="arrow">‚¨á</div>
                    
                    <div class="state-after">
                        <strong>AFTER:</strong><br>
                        "missing_fields": <span class="highlight-change">[]</span><br>
                        "validation_status": <span class="highlight-change">"complete"</span><br>
                        "input_complete": <span class="highlight-change">true</span><br>
                        "history": <span class="highlight-change">["Validation: Complete"]</span>
                    </div>
                </div>

                <div class="code-block">
                    <div class="code-label">üìä COMPLETE STATE AFTER NODE</div>
                    <pre>{
    <span class="json-key">"destination"</span>: <span class="json-value-string">"New York"</span>,
    <span class="json-key">"departure_date"</span>: <span class="json-value-string">"2026-02-26"</span>,
    <span class="json-key">"return_date"</span>: <span class="json-value-string">"2026-03-26"</span>,
    <span class="json-key">"passenger_count"</span>: <span class="json-value-number">2</span>,
    <span class="json-key">"max_budget"</span>: <span class="json-value-number">500.0</span>,
    <span class="json-key">"class_preference"</span>: <span class="json-value-string">"economy"</span>,
    <span class="json-key">"additional_info"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"missing_fields"</span>: <span class="highlight-change">[]</span>,
    <span class="json-key">"input_complete"</span>: <span class="highlight-change">true</span>,
    <span class="json-key">"validation_status"</span>: <span class="highlight-change">"complete"</span>,
    <span class="json-key">"flight_options"</span>: [],
    <span class="json-key">"search_timestamp"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"selected_flight"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"selection_reason"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"requires_approval"</span>: <span class="json-value-bool">false</span>,
    <span class="json-key">"approval_status"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"approver"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"booking_status"</span>: <span class="json-value-string">"new"</span>,
    <span class="json-key">"booking_id"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"booking_timestamp"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"error_message"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"retry_count"</span>: <span class="json-value-number">0</span>,
    <span class="json-key">"history"</span>: <span class="highlight-change">["Validation: Complete"]</span>
}</pre>
                </div>

                <div class="arrow">‚¨á</div>

                <div class="technical-note">
                    <strong>üîß ROUTING DECISION:</strong><br>
                    1. validate_input node finishes<br>
                    2. LangGraph checks for conditional edge<br>
                    3. Calls: route_after_validation(state)<br>
                    4. Function checks: if state["input_complete"] == true<br>
                    5. Returns: "complete"<br>
                    6. Dictionary lookup: {"complete": "search_flights"}<br>
                    7. LangGraph routes to: search_flights node
                </div>
            </div>

            <!-- ========================================== -->
            <!-- STEP 2: SEARCH FLIGHTS -->
            <!-- ========================================== -->
            <div class="step-container">
                <div class="step-header">
                    <span class="step-number">2</span>
                    NODE: SEARCH_FLIGHTS
                </div>

                <div class="section-title">üìã FUNCTION EXECUTION</div>
                
                <div class="code-block">
                    <div class="code-label">def search_flights(state: BookingState) -> BookingState:</div>
                    <pre>
# === STEP 1: READ FROM STATE ===
destination = state["destination"]        # "New York"
date = state["departure_date"]            # "2026-02-26"

# === STEP 2: UPDATE STATUS ===
state["booking_status"] = "searching"
state["history"].append(f"Starting flight search to {destination} on {date}")

# === STEP 3: CALL API (SIMULATED) ===
response = search_flights_api(destination, date)

# API Response:
{
    "success": true,
    "flights": [
        {
            "airline": "Airline A",
            "price": 320,
            "departure_time": "8:00 AM",
            "arrival_time": "12:00 PM",
            "stops": 0,
            "flight_number": "AA101",
            "aircraft": "Boeing 737",
            "available_seats": 25
        },
        {
            "airline": "Airline B",
            "price": 250,
            "departure_time": "2:00 PM",
            "arrival_time": "6:00 PM",
            "stops": 0,
            "flight_number": "BB202",
            "aircraft": "Boeing 737",
            "available_seats": 30
        },
        {
            "airline": "Airline C",
            "price": 380,
            "departure_time": "6:00 PM",
            "arrival_time": "10:00 PM",
            "stops": 1,
            "flight_number": "CC303",
            "aircraft": "Boeing 787",
            "available_seats": 15
        }
    ],
    "count": 3,
    "search_id": "SRCH-A1B2C3D4"
}

# === STEP 4: WRITE TO STATE ===
state["flight_options"] = response["flights"]
state["search_timestamp"] = "2026-02-26T10:30:00"
state["history"].append(f"Found {len(response['flights'])} flights")
state["history"].append(f"Search ID: {response['search_id']}")

# === STEP 5: RETURN UPDATED STATE ===
return state</pre>
                </div>

                <div class="section-title">üìä STATE CHANGES</div>
                
                <div class="state-diff">
                    <div class="state-before">
                        <strong>BEFORE:</strong><br>
                        "booking_status": "new"<br>
                        "flight_options": []<br>
                        "search_timestamp": null<br>
                        "history": ["Validation: Complete"]
                    </div>
                    
                    <div class="arrow">‚¨á</div>
                    
                    <div class="state-after">
                        <strong>AFTER:</strong><br>
                        "booking_status": <span class="highlight-change">"searching"</span><br>
                        "flight_options": <span class="highlight-change">[3 flights]</span><br>
                        "search_timestamp": <span class="highlight-change">"2026-02-26T10:30:00"</span><br>
                        "history": <span class="highlight-change">["Validation: Complete", "Starting flight search...", "Found 3 flights", "Search ID: SRCH-A1B2C3D4"]</span>
                    </div>
                </div>

                <div class="code-block">
                    <div class="code-label">üìä COMPLETE STATE AFTER NODE</div>
                    <pre>{
    <span class="json-key">"destination"</span>: <span class="json-value-string">"New York"</span>,
    <span class="json-key">"departure_date"</span>: <span class="json-value-string">"2026-02-26"</span>,
    <span class="json-key">"return_date"</span>: <span class="json-value-string">"2026-03-26"</span>,
    <span class="json-key">"passenger_count"</span>: <span class="json-value-number">2</span>,
    <span class="json-key">"max_budget"</span>: <span class="json-value-number">500.0</span>,
    <span class="json-key">"class_preference"</span>: <span class="json-value-string">"economy"</span>,
    <span class="json-key">"additional_info"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"missing_fields"</span>: [],
    <span class="json-key">"input_complete"</span>: <span class="json-value-bool">true</span>,
    <span class="json-key">"validation_status"</span>: <span class="json-value-string">"complete"</span>,
    <span class="json-key">"flight_options"</span>: <span class="highlight-change">[
        {
            "airline": "Airline A",
            "price": 320,
            "departure_time": "8:00 AM",
            "arrival_time": "12:00 PM",
            "stops": 0,
            "flight_number": "AA101",
            "aircraft": "Boeing 737",
            "available_seats": 25
        },
        {
            "airline": "Airline B",
            "price": 250,
            "departure_time": "2:00 PM",
            "arrival_time": "6:00 PM",
            "stops": 0,
            "flight_number": "BB202",
            "aircraft": "Boeing 737",
            "available_seats": 30
        },
        {
            "airline": "Airline C",
            "price": 380,
            "departure_time": "6:00 PM",
            "arrival_time": "10:00 PM",
            "stops": 1,
            "flight_number": "CC303",
            "aircraft": "Boeing 787",
            "available_seats": 15
        }
    ]</span>,
    <span class="json-key">"search_timestamp"</span>: <span class="highlight-change">"2026-02-26T10:30:00"</span>,
    <span class="json-key">"selected_flight"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"selection_reason"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"requires_approval"</span>: <span class="json-value-bool">false</span>,
    <span class="json-key">"approval_status"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"approver"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"booking_status"</span>: <span class="highlight-change">"searching"</span>,
    <span class="json-key">"booking_id"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"booking_timestamp"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"error_message"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"retry_count"</span>: <span class="json-value-number">0</span>,
    <span class="json-key">"history"</span>: <span class="highlight-change">[
        "Validation: Complete",
        "Starting flight search to New York on 2026-02-26",
        "Found 3 flights",
        "Search ID: SRCH-A1B2C3D4"
    ]</span>
}</pre>
                </div>

                <div class="arrow">‚¨á</div>

                <div class="technical-note">
                    <strong>üîß ROUTING DECISION:</strong><br>
                    1. search_flights node finishes<br>
                    2. LangGraph checks for edge<br>
                    3. Finds: "search_flights" ‚Üí "compare_select"<br>
                    4. Routes to: compare_select node<br>
                    5. Calls: compare_and_select_flight(state)
                </div>
            </div>

            <!-- ========================================== -->
            <!-- STEP 3: COMPARE AND SELECT -->
            <!-- ========================================== -->
            <div class="step-container">
                <div class="step-header">
                    <span class="step-number">3</span>
                    NODE: COMPARE_SELECT
                </div>

                <div class="section-title">üìã FUNCTION EXECUTION</div>
                
                <div class="code-block">
                    <div class="code-label">def compare_and_select_flight(state: BookingState) -> BookingState:</div>
                    <pre>
# === STEP 1: READ FROM STATE ===
flights = state["flight_options"]
# [
#   {"airline": "Airline A", "price": 320, "stops": 0},
#   {"airline": "Airline B", "price": 250, "stops": 0},
#   {"airline": "Airline C", "price": 380, "stops": 1}
# ]

max_budget = state["max_budget"]  # 500.0

# === STEP 2: UPDATE STATUS ===
state["booking_status"] = "comparing"
state["history"].append(f"Comparing {len(flights)} flights")

# === STEP 3: FILTER AND SELECT ===
# Filter flights within budget
affordable_flights = [f for f in flights if f["price"] <= max_budget]
# Result: All 3 flights are affordable

# Prefer direct flights
direct_flights = [f for f in affordable_flights if f["stops"] == 0]
# Result: 2 direct flights (Airline A: $320, Airline B: $250)

# Select cheapest direct flight
selected = min(direct_flights, key=lambda x: x["price"])
# Selected: {"airline": "Airline B", "price": 250, "stops": 0, ...}

# === STEP 4: CHECK IF APPROVAL NEEDED ===
# Need approval if price > 80% of budget
approval_threshold = max_budget * 0.8  # 500 * 0.8 = 400
requires_approval = selected["price"] > approval_threshold
# 250 > 400? No. requires_approval = False

# === STEP 5: WRITE TO STATE ===
state["selected_flight"] = selected
state["selection_reason"] = "cheapest_direct"
state["requires_approval"] = requires_approval
state["booking_status"] = "selected"
state["history"].append(
    f"Selected flight {selected['flight_number']} at ${selected['price']} "
    f"(Reason: cheapest_direct)"
)

# === STEP 6: RETURN UPDATED STATE ===
return state</pre>
                </div>

                <div class="section-title">üìä STATE CHANGES</div>
                
                <div class="state-diff">
                    <div class="state-before">
                        <strong>BEFORE:</strong><br>
                        "booking_status": "searching"<br>
                        "selected_flight": null<br>
                        "selection_reason": null<br>
                        "requires_approval": false
                    </div>
                    
                    <div class="arrow">‚¨á</div>
                    
                    <div class="state-after">
                        <strong>AFTER:</strong><br>
                        "booking_status": <span class="highlight-change">"selected"</span><br>
                        "selected_flight": <span class="highlight-change">{"airline": "Airline B", "price": 250, ...}</span><br>
                        "selection_reason": <span class="highlight-change">"cheapest_direct"</span><br>
                        "requires_approval": <span class="highlight-change">false</span>
                    </div>
                </div>

                <div class="code-block">
                    <div class="code-label">üìä COMPLETE STATE AFTER NODE (KEY FIELDS)</div>
                    <pre>{
    <span class="json-key">"destination"</span>: <span class="json-value-string">"New York"</span>,
    <span class="json-key">"departure_date"</span>: <span class="json-value-string">"2026-02-26"</span>,
    <span class="json-key">"passenger_count"</span>: <span class="json-value-number">2</span>,
    <span class="json-key">"max_budget"</span>: <span class="json-value-number">500.0</span>,
    <span class="json-key">"selected_flight"</span>: <span class="highlight-change">{
        "airline": "Airline B",
        "price": 250,
        "departure_time": "2:00 PM",
        "arrival_time": "6:00 PM",
        "stops": 0,
        "flight_number": "BB202",
        "aircraft": "Boeing 737",
        "available_seats": 30
    }</span>,
    <span class="json-key">"selection_reason"</span>: <span class="highlight-change">"cheapest_direct"</span>,
    <span class="json-key">"requires_approval"</span>: <span class="highlight-change">false</span>,
    <span class="json-key">"booking_status"</span>: <span class="highlight-change">"selected"</span>,
    <span class="json-key">"history"</span>: <span class="highlight-change">[
        "Validation: Complete",
        "Starting flight search to New York on 2026-02-26",
        "Found 3 flights",
        "Search ID: SRCH-A1B2C3D4",
        "Comparing 3 flights",
        "Selected flight BB202 at $250 (Reason: cheapest_direct)"
    ]</span>
}</pre>
                </div>

                <div class="arrow">‚¨á</div>

                <div class="technical-note">
                    <strong>üîß ROUTING DECISION:</strong><br>
                    1. compare_select node finishes<br>
                    2. LangGraph checks for edge<br>
                    3. Finds: "compare_select" ‚Üí "check_approval"<br>
                    4. Routes to: check_approval node<br>
                    5. Calls: check_approval_required(state)
                </div>
            </div>

            <!-- ========================================== -->
            <!-- STEP 4: CHECK APPROVAL -->
            <!-- ========================================== -->
            <div class="step-container">
                <div class="step-header">
                    <span class="step-number">4</span>
                    NODE: CHECK_APPROVAL
                </div>

                <div class="section-title">üìã FUNCTION EXECUTION</div>
                
                <div class="code-block">
                    <div class="code-label">def check_approval_required(state: BookingState) -> BookingState:</div>
                    <pre>
# === STEP 1: READ FROM STATE ===
requires_approval = state["requires_approval"]  # false

# === STEP 2: CHECK IF APPROVAL NEEDED ===
if requires_approval:
    state["approval_status"] = "pending"
    state["booking_status"] = "awaiting_approval"
    state["history"].append("Approval required...")
else:
    # No approval needed
    state["history"].append("No approval needed, proceeding with booking")

# === STEP 3: RETURN UPDATED STATE ===
return state</pre>
                </div>

                <div class="section-title">üìä STATE CHANGES</div>
                
                <div class="state-diff">
                    <div class="state-before">
                        <strong>BEFORE:</strong><br>
                        "history": [..., "Selected flight BB202 at $250"]
                    </div>
                    
                    <div class="arrow">‚¨á</div>
                    
                    <div class="state-after">
                        <strong>AFTER:</strong><br>
                        "history": <span class="highlight-change">[..., "Selected flight BB202 at $250", "No approval needed, proceeding with booking"]</span>
                    </div>
                </div>

                <div class="arrow">‚¨á</div>

                <div class="technical-note">
                    <strong>üîß ROUTING DECISION (CONDITIONAL):</strong><br>
                    1. check_approval node finishes<br>
                    2. LangGraph checks for CONDITIONAL edge<br>
                    3. Calls: route_by_approval_need(state)<br>
                    4. Function checks: if state["requires_approval"] == false<br>
                    5. Returns: "skip_approval"<br>
                    6. Dictionary lookup: {"skip_approval": "book_flight"}<br>
                    7. Routes to: book_flight node<br>
                    8. SKIPS: request_approval and process_approval nodes
                </div>

                <div class="split-flow">
                    <div class="flow-path">
                        <div class="path-label">PATH TAKEN (requires_approval = false)</div>
                        <div class="node-box">
                            <div class="node-title">‚úÖ SKIP APPROVAL</div>
                            <div class="node-desc">Go directly to book_flight</div>
                        </div>
                    </div>
                    
                    <div class="flow-path">
                        <div class="path-label">PATH NOT TAKEN (if requires_approval = true)</div>
                        <div class="node-box" style="opacity: 0.5;">
                            <div class="node-title">‚è∏Ô∏è REQUEST APPROVAL</div>
                            <div class="node-desc">Would pause for manager approval</div>
                        </div>
                        <div class="arrow">‚¨á</div>
                        <div class="node-box" style="opacity: 0.5;">
                            <div class="node-title">üîÑ PROCESS APPROVAL</div>
                            <div class="node-desc">Would handle approve/reject decision</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========================================== -->
            <!-- STEP 5: BOOK FLIGHT -->
            <!-- ========================================== -->
            <div class="step-container">
                <div class="step-header">
                    <span class="step-number">5</span>
                    NODE: BOOK_FLIGHT
                </div>

                <div class="section-title">üìã FUNCTION EXECUTION</div>
                
                <div class="code-block">
                    <div class="code-label">def book_flight(state: BookingState) -> BookingState:</div>
                    <pre>
# === STEP 1: READ FROM STATE ===
selected = state["selected_flight"]
# {
#   "airline": "Airline B",
#   "price": 250,
#   "flight_number": "BB202",
#   ...
# }

passenger_count = state["passenger_count"]  # 2

# === STEP 2: UPDATE STATUS ===
state["booking_status"] = "booking"
state["history"].append("Attempting to book flight...")

# === STEP 3: CALL BOOKING API ===
response = book_flight_api(selected, passenger_count)

# API Response (90% success rate):
{
    "success": true,
    "booking_id": "BK-F7A3B2C1",
    "total_price": 500,  # 250 * 2 passengers
    "confirmation_code": "CONF-A1B2C3",
    "booking_time": "2026-02-26T11:00:00"
}

# === STEP 4: WRITE TO STATE ===
if response["success"]:
    state["booking_id"] = response["booking_id"]
    state["booking_timestamp"] = response["booking_time"]
    state["booking_status"] = "booked"
    state["history"].append(f"Flight booked successfully: {response['booking_id']}")
    state["history"].append(f"Confirmation code: {response['confirmation_code']}")
    state["history"].append(f"Total price: ${response['total_price']}")
else:
    # Handle failure (retry logic)
    state["error_message"] = response["error"]
    state["retry_count"] += 1

# === STEP 5: RETURN UPDATED STATE ===
return state</pre>
                </div>

                <div class="section-title">üìä STATE CHANGES</div>
                
                <div class="state-diff">
                    <div class="state-before">
                        <strong>BEFORE:</strong><br>
                        "booking_status": "selected"<br>
                        "booking_id": null<br>
                        "booking_timestamp": null
                    </div>
                    
                    <div class="arrow">‚¨á</div>
                    
                    <div class="state-after">
                        <strong>AFTER:</strong><br>
                        "booking_status": <span class="highlight-change">"booked"</span><br>
                        "booking_id": <span class="highlight-change">"BK-F7A3B2C1"</span><br>
                        "booking_timestamp": <span class="highlight-change">"2026-02-26T11:00:00"</span>
                    </div>
                </div>

                <div class="code-block">
                    <div class="code-label">üìä COMPLETE STATE AFTER NODE (KEY FIELDS)</div>
                    <pre>{
    <span class="json-key">"destination"</span>: <span class="json-value-string">"New York"</span>,
    <span class="json-key">"departure_date"</span>: <span class="json-value-string">"2026-02-26"</span>,
    <span class="json-key">"passenger_count"</span>: <span class="json-value-number">2</span>,
    <span class="json-key">"max_budget"</span>: <span class="json-value-number">500.0</span>,
    <span class="json-key">"selected_flight"</span>: {
        "airline": "Airline B",
        "price": 250,
        "flight_number": "BB202",
        ...
    },
    <span class="json-key">"booking_status"</span>: <span class="highlight-change">"booked"</span>,
    <span class="json-key">"booking_id"</span>: <span class="highlight-change">"BK-F7A3B2C1"</span>,
    <span class="json-key">"booking_timestamp"</span>: <span class="highlight-change">"2026-02-26T11:00:00"</span>,
    <span class="json-key">"history"</span>: <span class="highlight-change">[
        "Validation: Complete",
        "Starting flight search to New York on 2026-02-26",
        "Found 3 flights",
        "Search ID: SRCH-A1B2C3D4",
        "Comparing 3 flights",
        "Selected flight BB202 at $250 (Reason: cheapest_direct)",
        "No approval needed, proceeding with booking",
        "Attempting to book flight...",
        "Flight booked successfully: BK-F7A3B2C1",
        "Confirmation code: CONF-A1B2C3",
        "Total price: $500"
    ]</span>
}</pre>
                </div>

                <div class="arrow">‚¨á</div>

                <div class="technical-note">
                    <strong>üîß ROUTING DECISION (CONDITIONAL):</strong><br>
                    1. book_flight node finishes<br>
                    2. LangGraph checks for CONDITIONAL edge<br>
                    3. Calls: route_by_booking_result(state)<br>
                    4. Function checks: if state["booking_status"] == "booked"<br>
                    5. Returns: "success"<br>
                    6. Dictionary lookup: {"success": "send_confirmation"}<br>
                    7. Routes to: send_confirmation node
                </div>
            </div>

            <!-- ========================================== -->
            <!-- STEP 6: SEND CONFIRMATION -->
            <!-- ========================================== -->
            <div class="step-container">
                <div class="step-header">
                    <span class="step-number">6</span>
                    NODE: SEND_CONFIRMATION
                </div>

                <div class="section-title">üìã FUNCTION EXECUTION</div>
                
                <div class="code-block">
                    <div class="code-label">def send_confirmation(state: BookingState) -> BookingState:</div>
                    <pre>
# === STEP 1: READ FROM STATE ===
booking_id = state["booking_id"]  # "BK-F7A3B2C1"
selected = state["selected_flight"]
email = "customer@example.com"  # In real app, from user data

# === STEP 2: UPDATE STATUS ===
state["booking_status"] = "confirming"
state["history"].append("Sending confirmation...")

# === STEP 3: CALL EMAIL API ===
response = send_confirmation_email_api(booking_id, email)

# API Response:
{
    "success": true,
    "email_sent": true,
    "email_id": "EMAIL-D4E5F6G7",
    "sent_at": "2026-02-26T11:01:00"
}

# === STEP 4: WRITE TO STATE ===
if response["success"]:
    state["booking_status"] = "confirmed"
    state["history"].append(f"Confirmation sent: {response['email_id']}")
    
    # Print confirmation (simulated email)
    print("="*50)
    print("BOOKING CONFIRMATION")
    print("="*50)
    print(f"Booking ID: {booking_id}")
    print(f"Flight: {selected['flight_number']}")
    print(f"Airline: {selected['airline']}")
    print(f"Price: ${selected['price']}")
    print("="*50)

# === STEP 5: RETURN UPDATED STATE ===
return state</pre>
                </div>

                <div class="section-title">üìä STATE CHANGES</div>
                
                <div class="state-diff">
                    <div class="state-before">
                        <strong>BEFORE:</strong><br>
                        "booking_status": "booked"
                    </div>
                    
                    <div class="arrow">‚¨á</div>
                    
                    <div class="state-after">
                        <strong>AFTER:</strong><br>
                        "booking_status": <span class="highlight-change">"confirmed"</span>
                    </div>
                </div>

                <div class="code-block">
                    <div class="code-label">üìä FINAL STATE (COMPLETE)</div>
                    <pre>{
    <span class="json-key">"destination"</span>: <span class="json-value-string">"New York"</span>,
    <span class="json-key">"departure_date"</span>: <span class="json-value-string">"2026-02-26"</span>,
    <span class="json-key">"return_date"</span>: <span class="json-value-string">"2026-03-26"</span>,
    <span class="json-key">"passenger_count"</span>: <span class="json-value-number">2</span>,
    <span class="json-key">"max_budget"</span>: <span class="json-value-number">500.0</span>,
    <span class="json-key">"class_preference"</span>: <span class="json-value-string">"economy"</span>,
    <span class="json-key">"additional_info"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"missing_fields"</span>: [],
    <span class="json-key">"input_complete"</span>: <span class="json-value-bool">true</span>,
    <span class="json-key">"validation_status"</span>: <span class="json-value-string">"complete"</span>,
    <span class="json-key">"flight_options"</span>: [
        {
            "airline": "Airline A",
            "price": 320,
            "flight_number": "AA101",
            ...
        },
        {
            "airline": "Airline B",
            "price": 250,
            "flight_number": "BB202",
            ...
        },
        {
            "airline": "Airline C",
            "price": 380,
            "flight_number": "CC303",
            ...
        }
    ],
    <span class="json-key">"search_timestamp"</span>: <span class="json-value-string">"2026-02-26T10:30:00"</span>,
    <span class="json-key">"selected_flight"</span>: {
        "airline": "Airline B",
        "price": 250,
        "departure_time": "2:00 PM",
        "arrival_time": "6:00 PM",
        "stops": 0,
        "flight_number": "BB202",
        "aircraft": "Boeing 737",
        "available_seats": 30
    },
    <span class="json-key">"selection_reason"</span>: <span class="json-value-string">"cheapest_direct"</span>,
    <span class="json-key">"requires_approval"</span>: <span class="json-value-bool">false</span>,
    <span class="json-key">"approval_status"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"approver"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"booking_status"</span>: <span class="highlight-change">"confirmed"</span>,
    <span class="json-key">"booking_id"</span>: <span class="json-value-string">"BK-F7A3B2C1"</span>,
    <span class="json-key">"booking_timestamp"</span>: <span class="json-value-string">"2026-02-26T11:00:00"</span>,
    <span class="json-key">"error_message"</span>: <span class="json-value-null">null</span>,
    <span class="json-key">"retry_count"</span>: <span class="json-value-number">0</span>,
    <span class="json-key">"history"</span>: [
        "Validation: Complete",
        "Starting flight search to New York on 2026-02-26",
        "Found 3 flights",
        "Search ID: SRCH-A1B2C3D4",
        "Comparing 3 flights",
        "Selected flight BB202 at $250 (Reason: cheapest_direct)",
        "No approval needed, proceeding with booking",
        "Attempting to book flight...",
        "Flight booked successfully: BK-F7A3B2C1",
        "Confirmation code: CONF-A1B2C3",
        "Total price: $500",
        "Sending confirmation...",
        "Confirmation sent: EMAIL-D4E5F6G7"
    ]
}</pre>
                </div>

                <div class="arrow">‚¨á</div>

                <div class="technical-note">
                    <strong>üîß ROUTING DECISION:</strong><br>
                    1. send_confirmation node finishes<br>
                    2. LangGraph checks for edge<br>
                    3. Finds: "send_confirmation" ‚Üí END<br>
                    4. Routes to: END<br>
                    5. WORKFLOW COMPLETE
                </div>

                <div class="node-box" style="background: #001100; border-color: #0f0;">
                    <div class="node-title">‚úÖ END - WORKFLOW COMPLETE</div>
                    <div class="node-desc">Flight booking successful!</div>
                </div>
            </div>

            <!-- ========================================== -->
            <!-- SUMMARY -->
            <!-- ========================================== -->
            <div class="step-container">
                <div class="step-header">
                    <span class="step-number">üìã</span>
                    COMPLETE EXECUTION SUMMARY
                </div>

                <div class="section-title">üîÑ EXECUTION FLOW DIAGRAM</div>
                
                <div class="flow-diagram">
                    <div class="code-block">
                        <pre>
USER INPUT
    ‚Üì
app.invoke(initial_state, config) <-- EXECUTION STARTS HERE
    ‚Üì
START edge ‚Üí validate_input
    ‚Üì
validate_input(state) executes
    ‚Üì (state updated: input_complete=true)
    ‚Üì
Conditional edge: route_after_validation(state) returns "complete"
    ‚Üì
search_flights(state) executes
    ‚Üì (state updated: flight_options=[...])
    ‚Üì
Edge: search_flights ‚Üí compare_select
    ‚Üì
compare_and_select_flight(state) executes
    ‚Üì (state updated: selected_flight={...}, requires_approval=false)
    ‚Üì
Edge: compare_select ‚Üí check_approval
    ‚Üì
check_approval_required(state) executes
    ‚Üì (state updated: history appended)
    ‚Üì
Conditional edge: route_by_approval_need(state) returns "skip_approval"
    ‚Üì
book_flight(state) executes
    ‚Üì (state updated: booking_id="BK-F7A3B2C1", booking_status="booked")
    ‚Üì
Conditional edge: route_by_booking_result(state) returns "success"
    ‚Üì
send_confirmation(state) executes
    ‚Üì (state updated: booking_status="confirmed")
    ‚Üì
Edge: send_confirmation ‚Üí END
    ‚Üì
WORKFLOW COMPLETE - Returns final state
</pre>
                    </div>
                </div>

                <div class="section-title">üìä STATE TRANSFORMATION SUMMARY</div>
                
                <div class="state-diff">
                    <div class="state-before">
                        <strong>INITIAL STATE:</strong><br>
                        - All user input fields filled<br>
                        - All result fields empty (null or [])<br>
                        - booking_status: "new"<br>
                        - history: []
                    </div>
                    
                    <div class="arrow">‚¨á</div>
                    
                    <div class="state-after">
                        <strong>FINAL STATE:</strong><br>
                        - flight_options: [3 flights]<br>
                        - selected_flight: Airline B flight<br>
                        - booking_id: "BK-F7A3B2C1"<br>
                        - booking_status: "confirmed"<br>
                        - history: [13 events]<br>
                        - All workflow complete!
                    </div>
                </div>

                <div class="section-title">üîë KEY TECHNICAL CONCEPTS</div>
                
                <div class="process-flow">
                    <div class="process-step">
                        <strong>1. STATE PERSISTENCE:</strong><br>
                        State flows through all nodes. Each node reads, modifies, and returns state.
                    </div>
                    
                    <div class="process-step">
                        <strong>2. NODE EXECUTION:</strong><br>
                        Each node is a function: node_name(state) ‚Üí updated_state
                    </div>
                    
                    <div class="process-step">
                        <strong>3. EDGE ROUTING:</strong><br>
                        Simple edges: A ‚Üí B (always go to B)<br>
                        Conditional edges: Decision function returns string, lookup in dictionary
                    </div>
                    
                    <div class="process-step">
                        <strong>4. WORKFLOW COMPILATION:</strong><br>
                        workflow.compile() creates executable app<br>
                        app.invoke(state, config) starts execution
                    </div>
                    
                    <div class="process-step">
                        <strong>5. EXECUTION ORDER:</strong><br>
                        START ‚Üí Node 1 ‚Üí Node 2 ‚Üí ... ‚Üí END<br>
                        Determined by edges (simple and conditional)
                    </div>
                </div>

                <div class="section-title">üéØ WHAT HAPPENED IN THIS EXAMPLE</div>
                
                <div class="code-block">
                    <pre>
1. User entered booking details in form
2. Frontend created initial_state object
3. Called: app.invoke(initial_state, config)
4. LangGraph started execution from START
5. Validated input (complete ‚Üí continue)
6. Searched for 3 flights to New York
7. Selected cheapest direct flight ($250)
8. Checked approval (not needed ‚Üí skip)
9. Booked flight successfully (ID: BK-F7A3B2C1)
10. Sent confirmation email
11. Workflow complete ‚Üí returned final state
12. Frontend displays: "Booking Confirmed!"
</pre>
                </div>
            </div>

        </div>
    </div>
</body>
</html>
